(this.webpackJsonpmultiplayer_chess=this.webpackJsonpmultiplayer_chess||[]).push([[0],{44:function(e,t,n){var a={"./bB.svg":62,"./bK.svg":63,"./bN.svg":64,"./bP.svg":65,"./bQ.svg":66,"./bR.svg":67,"./wB.svg":68,"./wK.svg":69,"./wN.svg":70,"./wP.svg":71,"./wQ.svg":72,"./wR.svg":73};function o(e){var t=c(e);return n(t)}function c(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}o.keys=function(){return Object.keys(a)},o.resolve=c,e.exports=o,o.id=44},53:function(e,t,n){e.exports=n(98)},58:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){e.exports=n.p+"static/media/bB.cb69fc1a.svg"},63:function(e,t,n){e.exports=n.p+"static/media/bK.e3451fff.svg"},64:function(e,t,n){e.exports=n.p+"static/media/bN.7b95d1a4.svg"},65:function(e,t,n){e.exports=n.p+"static/media/bP.876f1ece.svg"},66:function(e,t,n){e.exports=n.p+"static/media/bQ.8e8aadb6.svg"},67:function(e,t,n){e.exports=n.p+"static/media/bR.9a79237a.svg"},68:function(e,t,n){e.exports=n.p+"static/media/wB.b99f3830.svg"},69:function(e,t,n){e.exports=n.p+"static/media/wK.27fd3307.svg"},70:function(e,t,n){e.exports=n.p+"static/media/wN.b243da7d.svg"},71:function(e,t,n){e.exports=n.p+"static/media/wP.e38a4f66.svg"},72:function(e,t,n){e.exports=n.p+"static/media/wQ.518cd5f8.svg"},73:function(e,t,n){e.exports=n.p+"static/media/wR.0095917f.svg"},74:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAsAAAAGMAQMAAADuk4YmAAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAADlJREFUeF7twDEBAAAAwiD7p7bGDlgYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAGJrAABgPqdWQAAAABJRU5ErkJggg=="},75:function(e,t,n){},76:function(e,t,n){e.exports=n.p+"static/media/chess-sketch.26a89680.jpg"},82:function(e,t,n){},87:function(e,t,n){},88:function(e,t,n){},94:function(e,t,n){},95:function(e,t,n){},96:function(e,t,n){},97:function(e,t,n){e.exports=n.p+"static/media/home-image2.f8b888ec.jpg"},98:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),c=n(26),r=n.n(c),s=n(32),l=n(7),i=(n(58),n(14)),u=n(3),m="SET_POTENTIAL_MOVES",p="CLEAR_POTENTIAL_MOVES",f="CHECK_TURN",g="END_GAME",d="SET_PLAYER",v="SET_OPPONENT",b="SET_PLAYER_COLOR",E="SET_MESSAGE",h="CLEAR_MESSAGE",A="SET_OPPONENT_MOVES",O="CLEAR_OPPONENT_MOVES",j="SET_RELOAD_STATE",y="RECEIVE_RELOAD_STATE",N="SET_OPPONENT_LEFT_STATE",S="SET_CHESS_GAME_ID",C=function(e){return{type:v,name:null===e||void 0===e?void 0:e.name,color:null===e||void 0===e?void 0:e.color}},w=function(e){return{type:E,message:e}},D=function(e){return{type:j,reloadState:e}},P=function(e){return{type:y,receivedReloadState:e}},k=function(e){return{type:N,opponentLeftState:e}},R=function(e){return{type:S,chessGameID:e}},_=function(e,t){switch(console.log(t),t.type){case m:return Object(u.a)(Object(u.a)({},e),{},{potentialMoves:(n=t.moves,console.log(n),n.map((function(e){e.endsWith("+")&&(e=e.slice(0,-1));var t=e.length;return e.substring(t-2)})))});case p:return Object(u.a)(Object(u.a)({},e),{},{potentialMoves:[]});case f:return Object(u.a)(Object(u.a)({},e),{},{currentTurn:t.currentPlayer,inCheck:t.inCheck});case g:return Object(u.a)(Object(u.a)({},e),{},{endGame:!0,status:t.status,currentTurn:t.currentPlayer});case d:return Object(u.a)(Object(u.a)({},e),{},{playerName:t.name});case b:return Object(u.a)(Object(u.a)({},e),{},{playerColor:t.color});case v:return Object(u.a)(Object(u.a)({},e),{},{opponentName:t.name,opponentColor:t.color});case E:return Object(u.a)(Object(u.a)({},e),{},{message:t.message});case h:return Object(u.a)(Object(u.a)({},e),{},{message:""});case A:return Object(u.a)(Object(u.a)({},e),{},{opponentMoves:t.moves});case O:return Object(u.a)(Object(u.a)({},e),{},{opponentMoves:[]});case j:return Object(u.a)(Object(u.a)({},e),{},{reloadState:t.reloadState});case y:return Object(u.a)(Object(u.a)({},e),{},{receivedReloadState:t.receivedReloadState});case N:return Object(u.a)(Object(u.a)({},e),{},{opponentLeftState:t.opponentLeftState});case S:return Object(u.a)(Object(u.a)({},e),{},{chessGameID:t.chessGameID});default:return e}var n},T={potentialMoves:[],currentTurn:"w",inCheck:!1,endGame:!1,status:"",playerName:"",playerColor:"",opponentName:"",reloadState:!1,receivedReloadState:!1,opponentLeftState:!1,chessGameID:"",message:"",opponentMoves:[]},I=Object(a.createContext)(T),G=function(e){var t=e.children,n=Object(a.useReducer)(_,T),c=Object(i.a)(n,2),r=c[0],s=c[1];return o.a.createElement(I.Provider,{value:Object(u.a)(Object(u.a)({},r),{},{dispatch:s})},t)},x=n(48),M=n.n(x),L=n(5),B=n(6),K=Object(L.a)((function e(t,n){Object(B.a)(this,e),this.pob=t,this.piece=n})),U=function(e){return Array.from({length:e},(function(e,t){return t+1}))},F=function(e){var t=e.split(" ")[0].split("/").join(""),n=Array.from(t);n.forEach((function(e,t){Number.isInteger(Number(e))&&n.splice(t,1,U(e).fill(""))})),n=n.flat();for(var a=U(8).map((function(e){return e.toString()})).reverse(),o=["a","b","c","d","e","f","g","h"],c=[],r=0;r<a.length;r++)for(var s=a[r],l=0;l<o.length;l++){var i=o[l];c.push(i+s)}for(var u=[],m=0;m<c.length;m++){var p=c[m],f=n[m];u.push(new K(p,f))}return u},Q=(n(59),n(60),n(61),function(e){var t,c=e.name,r=e.pob,s=e.setFromPob,l=e.playerColor,i=c===c.toUpperCase()?"w":"b",u=i+c.toUpperCase(),m=Object(a.useRef)();try{t=n(44)("./".concat(u,".svg"))}catch(g){t=n(74)}var f=Object(a.useContext)(I).dispatch;return o.a.createElement("div",{className:"piece ".concat(l===i?"active":"inactive"),style:{background:"url(".concat(t,") center center/cover")},draggable:!0,ref:m,onDragStart:function(){s(r),setTimeout((function(){m.current.style.display="none"}),0)},onDragEnd:function(){m.current.style.display="block",f({type:p})},onClick:function(){return console.log({name:c,pob:r})}})}),J=function(e){var t=e.cell,n=e.index,c=e.moveChessPiece,r=e.setFromPob,s=e.playerColor,l=function(e,t){var n=e[1],a=function(e){return e%2===0};return!(!a(n)||a(t+1))||!(a(n)||!a(t+1))}(t.pob,n),i=Object(a.useContext)(I),u=i.potentialMoves,m=i.inCheck,p=i.currentTurn,f=u.includes(t.pob),g=t.piece.toUpperCase()===t.piece?"w":"b";return o.a.createElement("div",{className:"cell ".concat(l?"light":"dark"),onDrop:function(){c(t.pob)},onDragOver:function(e){return e.preventDefault()}},o.a.createElement("div",{className:"overlay ".concat(f&&"potential-move"," ").concat(function(){var e="K"===t.piece.toUpperCase();return p===g&&e&&m}()&&"in-check")},o.a.createElement(Q,{pob:t.pob,name:t.piece,setFromPob:r,playerColor:s})))},H=function(e){var t=e.cells;return o.a.createElement("div",{className:"board"},t.map((function(t,n){return o.a.createElement(J,Object.assign({cell:t,index:n,key:t.pob},e))})))},V=(n(75),function(){var e,t=Object(a.useContext)(I),c=t.status,r=t.currentTurn;console.log(I),"checkmate"===c&&(e="b"===r?"white":"black");var s=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"game-end-flex-container"},o.a.createElement("div",{className:"description-container"},o.a.createElement("div",{className:"description"},o.a.createElement("h1",null,"Game End"),o.a.createElement("p",{className:"end"},"The game ended in a ",o.a.createElement("mark",null,c)),e&&o.a.createElement("p",{className:"winner"},o.a.createElement("span",null,e)," won")),o.a.createElement("img",{src:n(76),alt:"A sketch of chess pieces",className:"checkmate"===c?"position-chess-img":"chess-img"}),o.a.createElement("a",{href:"/"},o.a.createElement("button",{className:"checkmate"===c?"position-play-again":"play-again"},"Play Again")))))};return o.a.createElement(s,null)}),Y=n(51),q=n(36),W=n.n(q),X=(n(82),function(e){var t=e.name,a=e.color,c=e.player,r="w"===a?"wK":"bK";return o.a.createElement("div",{className:"player ".concat(c?"you":"opponent")},o.a.createElement("p",null,t),o.a.createElement("img",{src:n(44)("./".concat(r,".svg")),alt:"King",className:"king"}))}),z=n(113),Z=function(){var e=Object(a.useContext)(I),t=e.message,n=e.dispatch;return o.a.createElement(z.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:!!t,autoHideDuration:2500,onClose:function(){n({type:h})},ContentProps:{"aria-describedby":"message-id"},message:t})},$=(n(87),function(e){var t=e.onClick,n=e.children;return o.a.createElement("a",{className:"home-button-link",href:"/"},o.a.createElement("button",{onClick:t,className:"home-button"},n))}),ee=(n(88),Y.a.connect("localhost:3001",{reconnection:!0,reconnectionDelay:500,reconnectionAttempts:10})),te=function(){var e=Object(a.useRef)(),t=Object(a.useRef)();Object(a.useEffect)((function(){N||(t.current=e.current.offsetWidth)}),[e.current]);var n=Object(a.useState)("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),c=Object(i.a)(n,2),r=c[0],s=c[1],u=Object(a.useRef)(new M.a(r)).current,v=Object(a.useState)(F(r)),E=Object(i.a)(v,2),h=E[0],O=E[1],j=Object(a.useContext)(I),y=j.dispatch,N=j.endGame,S=j.playerName,R=j.playerColor,_=j.opponentName,T=j.reloadState,G=j.receivedReloadState,x=j.opponentLeftState;Object(a.useEffect)((function(){O(F(r))}),[r]);var L=Object(a.useRef)(),B=Object(l.f)(),K=Object(l.e)(),U=Object(a.useRef)(),Q=Object(a.useRef)("");return Object(a.useEffect)((function(){var e=function(e){return e.game_over()?e.in_checkmate()?[!0,"checkmate"]:e.in_stalemate()?[!0,"stalemate"]:e.in_threefold_repetition()?[!0,"three fold repetition"]:e.in_draw()?[!0,"draw"]:void 0:[!1,""]}(u),t=Object(i.a)(e,2),n=t[0],a=t[1];y(n?{type:g,status:a,currentPlayer:u.turn()}:{type:f,currentPlayer:u.turn(),inCheck:u.in_check()})}),[r,y,u]),Object(a.useEffect)((function(){var e=W.a.parse(B.search),t=e.id,n=e.name;console.log(t,n),U.current=n,Q.current=t}),[B.search]),Object(a.useEffect)((function(){ee.emit("join",{name:U.current,gameID:Q.current},(function(e){var t,n=e.error,a=e.error2,o=e.color;n&&(console.log(n),K.push("/")),a&&console.log(a),console.log({color:o}),y((t=U.current,{type:d,name:t})),y(function(e){return{type:b,color:e}}(o)),console.log(u.turn())})),ee.on("welcome",(function(e){var t=e.message,n=e.opponent;console.log({message:t,opponent:n}),y(w(t)),y(C(n))})),ee.on("opponentJoin",(function(e){var t=e.message,n=e.opponent;console.log({message:t,opponent:n}),console.log(r,typeof r),y(w(t)),y(C(n)),console.log("opponent",n)})),ee.on("opponentMove",(function(e){var t=e.from,n=e.to;console.log("opponent",t,n),u.move({from:t,to:n}),s(u.fen()),y(w("Your Turn")),y({type:A,moves:[t,n]})})),ee.on("opponentLeft",(function(){y(C("")),console.log(G,x),!1===G&&y(k(!0))})),ee.on("message",(function(e){var t=e.message;console.log({message:t}),t.includes("has left the game")?console.log(!0,t):console.log(!1,t),y(w(t))}))}),[u,K,y]),Object(a.useEffect)((function(){!0===x&&ee.on("opponentJoin",(function(){!1===G&&y(D(!0))}))}),[y,x]),Object(a.useEffect)((function(){!0===T&&(ee.emit("sendReloadState",{backendReloadState:T}),setTimeout((function(){window.location.reload(!1)}),1e3))}),[y,T]),Object(a.useEffect)((function(){ee.on("receiveReloadState",(function(e){var t=e.receivedFromOpponentReloadState;console.log("received from opponent reload state",t),!0===t&&(y(P(!0)),ee.emit("resetStates"))}))}),[y,G]),Object(a.useEffect)((function(){ee.on("resetStatesReceive",(function(){y(P(!1)),y(k(!1)),y(D(!1))}))}),[y,G,x,T]),N?o.a.createElement(V,null):o.a.createElement("div",{className:"game"},o.a.createElement("div",{className:"reload-tip"},"If your opponent leaves and rejoins, it will attempt to automatically reconnect."),o.a.createElement("div",{className:"link-tip"},"If you would like to play the game with a friend. Simply share the homepage and ask them to type in the current game id and a username."),o.a.createElement("div",{className:"game-id-container"},o.a.createElement("p",{className:"game-id-title"},"Game ID"),o.a.createElement("div",{style:{width:"".concat(t.current+50,"px")},className:"game-id"},o.a.createElement("span",{ref:e},Q.current))),o.a.createElement(X,{name:S,color:R,player:!0}),o.a.createElement(X,{name:_,color:"w"===R?"b":"w"}),o.a.createElement(H,{cells:h,moveChessPiece:function(e){var t=L.current,n=e;u.move({from:t,to:n}),console.log(n),y({type:p}),s(u.fen()),console.log(Q),ee.emit("move",{gameID:Q.current,from:t,to:n})},setFromPob:function(e){L.current=e,console.log(u.moves({square:e})),y({type:m,moves:u.moves({square:e})})},playerColor:R}),o.a.createElement($,null,"Play Another Game"),o.a.createElement(Z,null))},ne=(n(94),function(e){var t=e.HomeImage,n=e.HomeContent;return o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"app-title"},"Multiplayer Chess"),o.a.createElement("div",{className:"flex"},o.a.createElement(t,null),o.a.createElement("div",{className:"content"},o.a.createElement(n,null))))}),ae=(n(95),n(96),function(e){var t=e.onClick,n=e.children;return o.a.createElement("button",{onClick:t,className:"button"},n)}),oe=function(){var e=Object(a.useContext)(I),t=e.dispatch,n=e.chessGameID,c=Object(a.useState)(""),r=Object(i.a)(c,2),s=r[0],u=r[1],m=Object(a.useState)(!1),p=Object(i.a)(m,2),f=p[0],g=p[1],d=Object(l.e)(),v=Object(l.f)(),b=W.a.parse(v.search).id;Object(a.useEffect)((function(){if(b)return console.log(v,b),t(R(b));if(!1===f){var e=Math.random().toString().replace("0.","");console.log(v,e),console.log(n),t(R(e))}}),[t,f,b,v]);return o.a.createElement("div",{className:"home-container"},o.a.createElement("h2",null,"Play Chess with your friends online"),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),console.log("chessGameID",n),s&&n&&d.push("/game?name=".concat(s,"&id=").concat(n))}},o.a.createElement("input",{type:"text",className:"input",value:s,onChange:function(e){var t=e.target;return u(t.value)},placeholder:"Player Name"}),o.a.createElement("input",{onChange:function(e){var n=e.target;t(R(n.value)),g(!0)},placeholder:"Game ID",className:"gameID-input"}),o.a.createElement("div",{className:"gameID"},"Game ID: ",n),o.a.createElement("hr",null),o.a.createElement(ae,null,"Create")))},ce=function(){return o.a.createElement(ne,{HomeContent:oe,HomeImage:function(){return o.a.createElement("img",{src:n(97),alt:"home",className:"bg-img"})}})};var re=function(){return o.a.createElement(s.a,null,o.a.createElement(G,null,o.a.createElement(l.a,{path:"/game",component:te}),o.a.createElement(l.a,{path:"/",exact:!0,component:ce})))};r.a.render(o.a.createElement(re,null),document.getElementById("root"))}},[[53,1,2]]]);
//# sourceMappingURL=main.086f75a9.chunk.js.map